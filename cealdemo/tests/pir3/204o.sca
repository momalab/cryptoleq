# PIR example

.pragma k=5 r=17 beta=8

.pragma PQ=239.251
#.pragma PQ=63199.64567
#.pragma PQ=4281167959.4271299633
#.pragma PQ=18299379327617480707.18345258783657292909
#.pragma PQ=338871469111127928412308213206819656391.338531414912581056934822037249894061881
#.pragma PQ=115689526107095890311249333520175779978137070980169508677335528535095435701957.115509443392406915656501893779637949187966713758992043305916442498716409678501
#.pragma PQ=13392849694255970315601419090152597688339809774933571293865724091737666496951381207429127235940384883608845778583380210687006370486238723021460371010217257.13403952390292880134486926689236901739298695038033079040680862117777593853851234125818128702776151240584166261477766002390185782669746209391687589482784501


.pragma io=ts incdir=../lib/

.mov    ozero   sum

start:
.mov21  p key
.inc    p
.mov21  p val
.inc    p
.dec    db_size
.dec    db_size

#.seq    key input x
#.smul   x val y
#.add    y sum

.mov	ozero x
.ifneq key input skip
.mov	one x
skip:

.omul	x val y
.add	y sum

#.out key
#.out val
.out    sum #

.ifneq  db_size ozero start

.out    sum
.out    sum #

.halt

. sum:0 key:0 val:0 p:db_start x:0 y:0

# data
db_start:
.include "dbo.opn"
db_end:

input:;.include "inputo.opn"

db_size: (db_end - db_start)

# constants
. ozero:0 one:1

.include "secure.lib"
